# 自我突破的OLAPServer时期

如果说 `Metrage` 系统是弥补 `Yandex.Metrica` 性能瓶颈的产物，那么 `OLAPServer` 系统的诞生，则是产品形态升级倒逼的结果。在 `Yandex.Metrica` 的产品初期，它只支持固定报表的分析功能。随着时间的推移，这种固化的分析形式早已不能满足用户需求，于是 `Yandex.Metrica` 计划退出自定义分析报告的功能。然而 `Metrage` 系统却无法满足这类自定义的分析场景，因为它需要预先聚合，并且只能提供内置的 `40` 多种固定分析场景。单独为每一个用户提供面向个人的预聚合功能显然是不切实际的。在这种背景下， `Yandex.Metrica` 的研发团队只有寻求自我突破，于是自主研发了 `OLAPServer` 系统。

`OLAPServer` 系统被设计成专门处理自定义报告这类临时性分析需求的系统，与 `Metrage` 系统形成互补的关系。结合之前两个阶段的建设经验， `OLAPServer` 在设计思路上可以说是取众家之长：
* 在数据模型方面，它有换回了**关系模型**，因为相比`Key-Value`模型，关系模型拥有更好的描述能力。使用`SQL`作为查询语言，也将会拥有更好地“**群众基础**”。
* 在存储结构和索引方面，他结合了`MyISAM`和`LSM`树最精华的部分。
* 在存储结构上它与`MyISAM`表引擎类似，分为了**索引文件**和**数据文件**两个部分。
* 在索引方面，它并没有完全沿用`LSM`树，而是使用了`LSM`树所使用到的**稀疏索引**。
* 在数据文件的设计上，则沿用了`LSM`树中数据段的思想，即**数据段内数据有序，借助稀疏索引定位数据段**。

有了上述基础后， `OLAPServer` 又进一步引入了**列式存储**的思想，将索引文件和数据文件按照列字段的粒度进行了拆分，每个列字段各自独立存储，以此进一步减少数据读取的范围。

虽然 `OLAPServer` 在实时聚合方面的性能相比 `MySQL` 有了质的飞跃，但从功能的完备性角度来看， `OLAPServer` 还是差了一个量级。如果说 `MySQL` 可以称为**数据库管理系统**（ `DBMS` ），那么 `OLAPServer` 只能称为**数据库**。因为 `OLAPServer` 的定位只是和 `Metrage` 形成互补，所以它缺失了一些基本的功能。例如，它只有一种数据类型，即**固定长度的数值类型**，且没有 `DBMS` 应有的基本功能（ `DDL` 查询等）。

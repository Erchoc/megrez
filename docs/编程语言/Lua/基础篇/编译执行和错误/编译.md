# 编译

此前，我们已经介绍过函数dofile，它是运行Lua代码的主要方式之一。实际上，函数dofile是一个辅助函数，函数loadfile才完成了真正的核心工作。与函数dofile类似，函数loadfile也是从文件中加载Lua代码段，但它不会运行代码，而只是编译代码，然后将编译后的代码段作为一个函数返回。此外，与函数dofile不同，函数loadfile只返回错误码而不抛出异常。可以认为，函数dofile就是：

```lua
function dofile (filename)
  local f = assert(loadfile(filename))
  return f()
end
```

> [!warning|label: 注意]
> 如果函数loadfile执行失败，那么函数assert会引发一个错误。

对于简单的需求而言，由于函数dofile在一次调用中就做完了所有工作，所以函数非常易用。不过，函数loadfile更灵活。在发生错误的情况中，函数loadfile会返回nil及错误信息，以允许我们按自定义的方式来处理错误。此外，如果需要多次运行同一个文件，那么只需要用一次loadfile函数后再次调用它的返回结果即可。由于只编译一次文件，因此这种方式的开销要不多次调用函数dofile小得多（编译在某种程度上相比其他操作开销更大）。

函数load与函数loadfile
# 反射 (Reflection)

> [!tip|label: 俗话说]
> 反射，反射，程序员的快乐！

反射是程序用来**检查**和**修改**其自身某些部分的能力。像 `Lua` 语言这样的动态语言支持以下几种反射机制：

1. 环境允许运行时观察全局变量。
2. 诸如type和pairs这样的函数允许运行时检查和遍历未知数据结构。
3. 诸如load和require这样的函数允许程序在自身中追加代码或更新代码。

不过，还有很多方面仍然是缺失的，例如：程序不能检查局部变量，开发人员不能跟踪代码的执行，函数也不知道是被谁调用的，等等。**调试库**（ `debug library` ）填补了上述的缺失。

调试库是由两类函数组成：**自省函数**和**钩子**。
* 自省函数允许我们检查一个正在运行中的程序的几个方面，例如活动函数的栈、当前正在执行的代码行、局部变量的名称和值。
* 钩子则允许我们跟踪一个程序的执行。

虽然名字里带有“**调试**”的字眼，但调试库提供的并不是 `Lua` 语言的调试器。不过，调试库提供了编写我们自己的调试器所需要的不同层次的所有底层机制。

调试库与其他库不同，**必须被慎重地使用**。首先，调试库中的某写功能的**性能不高**。其次，调试库会打破语言的一些固有规则，例如不能从一个局部变量的词法定界范围外访问这个局部变量。虽然调试库作为标准库直接可用，但是建议在使用调试库的代码段中显式地加载调试库。

# 灰度图（灰阶图）

**灰度图**， `Gray Scale Image` 或是 `Grey Scale Image` ，又称**灰阶图**。把**白色**与**黑色**之间按**对数关系**分为若干等级，称为**灰度**。灰度分为 `256阶` 。

用灰度表示的图像称作**灰度图**。除了常见的卫星图像、航空照片外，许多地球物理观测数据也以灰度表示。

## 计算方法

任何颜色都由**红**、**绿**、**蓝**三基色组成，假如原来某点的颜色为 `RGB(R，G，B)` ，则灰度转换方法有如下五种：

* 浮点法: `Gray=R*0.3+G*0.59+B*0.11`
* 整数法: `Gray=(R*30+G*59+B*11)/100`
* 移位法: `Gray =(R*77+G*151+B*28)>>8`
* 平均值法: `Gray=（R+G+B）/3`
* 仅取绿色: `Gray=G`

以上五种**老式**算法计算值**均有误差**，这些方法对于 `Gamma校正` 的图片(平常所见到的 `24位` 真彩色图片均为**Gamma校正**的图片)并不适用。

## Gamma校正

`RGB` 值与**显示器功率**并非简单的线性关系，而是**幂函数**关系，这个函数的**指数**称为 `Gamma值` ，一般为 `2.2` ，而这个换算过程，称为**Gamma校正**。

打个比方，功率为 `50%` 的灰色，人眼实际感知亮度为: 

$$\sqrt[2.2]{0.5} \times 100\%=72.97\%$$

而人眼认为的 `50%` 中灰色，实际功率为：

$$0.5^{2.2} \times 100\%=21.76\%$$

所以 `RGB` 中的灰度值，为了考虑到较小的存储范围 `[0, 255]` 和较平衡的亮暗部比例，所以需要进行**Gamma校正**，而不是直接对应功率值，因此 `RGB` 颜色值不能简单直接相加，而是必须用 `2.2` 次方换算成物理光功率后才能进行下一步计算。算法如下：

$$Gray=\sqrt[2.2]{\frac{R^{2.2}+\left ( 1.5G \right )^{2.2}+\left ( 0.6B \right )^{2.2} }{1^{2.2}+1.5^{2.2}+0.6^{2.2}   } } $$

注意这里的 `2.2` 次方和 `2.2` 次方根， `RGB` 颜色值不能简单直接相加，而是必须用 `2.2` 次方换算成物理光功率。

求得 `Gray` 后，将原来的 `RGB(R, G, B)` 中的 `R` , `G` , `B` 统一用 `Gray` 替换，形成新的颜色 `RGB(Gray, Gray, Gray)` ，用它替换原来的 `RGB(R, G, B)` 就是**灰度图**了。

鉴于**精确度**的要求，在高质量图片处理中最好使用**Gamma校正公式**进行计算，以保证准确度。

## 工程Demo
